<!DOCTYPE html>
<html>
<head>

<style type="text/css"> 
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 5px }
  #googleMap { height: 90%; margin: 5px }
  input { margin: 3px }
  #phi:hover {
</style> 


<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDadqq4rG3XNyc7HZZYrw8GH4CsFcV49bk&sensor=false">
</script>

<script type="text/javascript">
var map;
var directionsDisplay;
var directionsService = new google.maps.DirectionsService();

  

function initialize() {
  directionsDisplay = new google.maps.DirectionsRenderer({draggable:true});
  var mapProp = {
    center: new google.maps.LatLng(42.3736158, -71.109733),
    zoom: 12,
    mapTypeId: google.maps.MapTypeId.ROADMAP
    };
  map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
  directionsDisplay.setMap(map);
  google.maps.event.addListener(directionsDisplay, 'directions_changed', calcDist);
}

function geocodeStart() {
  var geocoder=new google.maps.Geocoder();
  var location=document.getElementById("location").value;
  var GeoReq={ address:location };
  geocoder.geocode(GeoReq, handleResults);  
}

function handleResults(results, status) {
  if (status == google.maps.GeocoderStatus.OK) {
    var LatLng=results[0].geometry.location;
    map.setCenter(LatLng);
    findPts(LatLng);
    }
  else {
    alert("Geocoding was unsuccessful because: " + status);
    }
}

function findPts(LatLng) {
  var Lat1 = LatLng.lat()*Math.PI/180; //LatLong in degrees; trig in radians
  var Long1 = LatLng.lng()*Math.PI/180;
  var theta = 2*Math.random()*Math.PI;
  var dist = document.getElementById("distance").value;
  var phi = Math.PI/180*document.getElementById("phi").value; //angle between leg1 and leg3
  var sign = 2*Math.round(Math.random())-1; //shift right or left
  var scale = 0.8; //straitline_distance/actual_distance
  var legDist = scale*dist/(2+2*Math.sin(phi/2));
  var r = 4000*Math.cos(Lat1); //horizontal radius at given latitude
  var Lat2 = legDist*Math.cos(theta)/4000+Lat1;
  var Long2 = Long1+legDist*Math.sin(theta)/r;
  var Lat3 = legDist*Math.cos(theta+sign*phi)/4000+Lat1;
  var Long3 = Long1+legDist*Math.sin(theta+sign*phi)/r;
  var LatLng2 = new google.maps.LatLng(Lat2*180/Math.PI, Long2*180/Math.PI);
  var LatLng3 = new google.maps.LatLng(Lat3*180/Math.PI, Long3*180/Math.PI);
  plotRoute(LatLng, LatLng2, LatLng3);
}

function plotRoute(LatLng1, LatLng2, LatLng3) {
  var request = {
    origin: LatLng1,
    destination: LatLng1,
    waypoints: [
      {
        location: LatLng2,
        stopover: false
      },
      {
        location: LatLng3,
        stopover: false
      }],
    travelMode: google.maps.TravelMode.WALKING,
    avoidHighways: true,
    optimizeWaypoints: true
    };
  directionsService.route(request, function(result, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(result);
    }
  });
}
  
function calcDist() {
  var routeDist = directionsDisplay.directions.routes[0].legs[0].distance.text;
  document.getElementById("routeDistance").innerHTML = routeDist;
}

function showDirections() {
  var openWindow = window.open("", "", "width=400, height=600");
  var steps = directionsDisplay.directions.routes[0].legs[0].steps
  var uniqueSteps = []
  for (var i=0; i<steps.length-1; i++) {
    if (steps[i] != uniqueSteps[uniqueSteps.length] && steps[i].instructions.split(" ").length>2) {
      uniqueSteps.push(steps[i].instructions+": "+steps[i].distance.text);
    }
  }
  openWindow.document.write(uniqueSteps.join("<br>"));
  var routeDist = document.getElementById("routeDistance").innerHTML;
  openWindow.document.write("<br><br>Total: "+routeDist);
  openWindow.focus();
}

google.maps.event.addDomListener(window, 'load', initialize);


</script>
</head>

<body>
<div id="header" style="height:8%">

<iframe src="http://ghbtns.com/github-btn.html?user=ben-eysenbach&repo=run_map&type=fork&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="90" height="40" style="position:absolute; right: 10px"></iframe>

<div>
Location<input id="location" style="width:300px" type="textbox" value="Cambridge, MA">
Distance (mi)<input id="distance" style="width:50px" type="number" min=0 value=5>
Angle<input id="phi" style="width:50px" type="number" min=0 max=180 value=60>
<input type="button" value="map" onclick="geocodeStart()"></div>
<div>
Route Distance: <span id="routeDistance"></span>
<input style="position:absolute; right:300px" type="button" value="show directions" onclick="showDirections()">
</div>
</div>


<div id="googleMap"></div>

</body>
</html>
